import{a as E,b as te}from"./index-9f2d25f2.js";import{_ as I,d as oe,a as L,u as ae}from"./useUsers-75ef2edc.js";import{d as T,j as r,c as m,l as F,k as N,m as u,e as k,B as G,S as se,p as o,q as p,t as w,s as R,F as M,y as H,C as D,Q as i,ad as q,z as A,_ as W,r as S,w as ne,M as le,f as re,ae as ie,U as ce}from"./index-aa1b58a7.js";import{u as de}from"./useModal-2ebef2e7.js";import"./utils-b2fc192b.js";const z=T({__name:"ProjectStatusBadge",props:{status:{type:String,required:!0}},setup(f){const b={"in progress":"primary",archived:"secondary",completed:"success",important:"warning"};return(d,v)=>{const n=r("VaBadge");return m(),F(n,{square:"",color:b[d.$props.status],text:d.$props.status.toUpperCase()},null,8,["color","text"])}}}),ue={class:"text-[var(--va-secondary)]"},pe={class:"flex flex-col items-center gap-4 grow"},me={class:"va-h4 text-center self-stretch overflow-hidden line-clamp-2 text-ellipsis"},ge=p("span",{class:"text-[var(--va-secondary)]"},"Owner: ",-1),ve={class:"flex justify-between"},_e={key:1,class:"p-4 flex justify-center items-center text-[var(--va-secondary)]"},fe=T({__name:"ProjectCards",props:{projects:{type:Array,required:!0},loading:{type:Boolean,required:!0}},emits:["edit","delete","open"],setup(f){const b=d=>{const v=["primary","#FFD43A","#ADFF00","#262824","danger"],n=d.charCodeAt(0)%v.length;return v[n]};return(d,v)=>{const n=r("VaImage"),h=r("VaAvatarGroup"),j=r("VaDivider"),C=r("VaButton"),V=r("VaCardContent"),c=r("VaCard"),a=r("VaInnerLoading"),l=N("tooltip");return f.projects.length>0||f.loading?(m(),F(a,{key:0,loading:f.loading,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 min-h-[4rem]"},{default:u(()=>[(m(!0),k(M,null,G(f.projects,t=>(m(),F(c,{key:t.project_name,style:se({"--va-card-outlined-border":"1px solid var(--va-background-element)"}),outlined:""},{default:u(()=>[o(n,{src:"/project-preview.png",class:"h-52"}),o(V,{class:"flex flex-col h-full"},{default:u(()=>[p("div",ue,w(t.creation_date),1),p("div",pe,[p("h4",me,w(t.project_name),1),p("p",null,[ge,p("span",null,w(t.project_owner.fullname),1)]),o(h,{class:"my-4",options:t.team.map(_=>({label:_.fullname,src:_.avatar,fallbackText:_.fullname[0],color:b(_.fullname)})),max:5},null,8,["options"]),o(z,{status:t.status},null,8,["status"])]),o(j,{class:"my-6"}),p("div",ve,[R(o(C,{preset:"secondary",icon:"visibility",color:"secondary",onClick:_=>d.$emit("open",t)},null,8,["onClick"]),[[l,"Open project in dashboard"]])])]),_:2},1024)]),_:2},1032,["style"]))),128))]),_:1},8,["loading"])):(m(),k("div",_e,"No projects"))}}}),be={class:"ellipsis max-w-[230px] lg:max-w-[450px]"},ye={class:"flex items-center gap-2 ellipsis max-w-[230px]"},je={class:"flex gap-2 justify-end"},Ve={class:"flex flex-col-reverse md:flex-row gap-2 justify-between items-center py-2"},xe={key:0,class:"flex"},we=T({__name:"ProjectsTable",props:{projects:{type:Array,required:!0},loading:{type:Boolean,required:!0},sortBy:{type:Object,required:!0},sortingOrder:{type:Object,required:!0},pagination:{type:Object,required:!0}},emits:["edit","delete","open"],setup(f,{emit:b}){const d=oe([{label:"Project name",key:"project_name",sortable:!0},{label:"Project owner",key:"project_owner",sortable:!0},{label:"Team",key:"team",sortable:!0},{label:"Status",key:"status",sortable:!0},{label:"Creation Date",key:"creation_date",sortable:!0},{label:" ",key:"actions"}]),v=f,n=b,h=c=>{const a=["primary","#FFD43A","#ADFF00","#262824","danger"],l=c.charCodeAt(0)%a.length;return a[l]},j=E(v,"sortBy",n),C=E(v,"sortingOrder",n),V=H(()=>Math.ceil(v.pagination.total/v.pagination.perPage));return(c,a)=>{const l=r("VaAvatarGroup"),t=r("VaButton"),_=r("VaDataTable"),$=r("VaSelect"),P=r("VaPagination"),B=N("tooltip");return m(),k("div",null,[o(_,{"sort-by":i(j),"onUpdate:sortBy":a[0]||(a[0]=s=>q(j)?j.value=s:null),"sorting-order":i(C),"onUpdate:sortingOrder":a[1]||(a[1]=s=>q(C)?C.value=s:null),items:f.projects,columns:i(d),loading:f.loading},{"cell(project_name)":u(({rowData:s})=>[p("div",be,w(s.project_name),1)]),"cell(project_owner)":u(({rowData:s})=>[p("div",ye,[o(I,{user:s.project_owner,size:"small"},null,8,["user"]),D(" "+w(s.project_owner.fullname),1)])]),"cell(team)":u(({rowData:s})=>[o(l,{size:"small",options:s.team.map(e=>({label:e.fullname,src:e.avatar,fallbackText:e.fullname[0],color:h(e.fullname)})),max:5},null,8,["options"])]),"cell(status)":u(({rowData:s})=>[o(z,{status:s.status},null,8,["status"])]),"cell(actions)":u(({rowData:s})=>[p("div",je,[R(o(t,{preset:"primary",size:"small",color:"primary",icon:"visibility",onClick:e=>c.$emit("open",s)},null,8,["onClick"]),[[B,"Open project in dashboard"]])])]),_:1},8,["sort-by","sorting-order","items","columns","loading"]),p("div",Ve,[p("div",null,[p("b",null,w(c.$props.pagination.total)+" results.",1),D(" Results per page "),o($,{modelValue:c.$props.pagination.perPage,"onUpdate:modelValue":a[2]||(a[2]=s=>c.$props.pagination.perPage=s),class:"!w-20",options:[10,50,100]},null,8,["modelValue"])]),V.value>1?(m(),k("div",xe,[o(t,{preset:"secondary",icon:"va-arrow-left","aria-label":"Previous page",disabled:c.$props.pagination.page===1,onClick:a[3]||(a[3]=s=>c.$props.pagination.page--)},null,8,["disabled"]),o(t,{class:"mr-2",preset:"secondary",icon:"va-arrow-right","aria-label":"Next page",disabled:c.$props.pagination.page===V.value,onClick:a[4]||(a[4]=s=>c.$props.pagination.page++)},null,8,["disabled"]),o(P,{modelValue:c.$props.pagination.page,"onUpdate:modelValue":a[5]||(a[5]=s=>c.$props.pagination.page=s),"buttons-preset":"secondary",pages:V.value,"visible-pages":5,"boundary-links":!1,"direction-links":!1},null,8,["modelValue","pages"])])):A("",!0)])])}}});const ke=W(we,[["__scopeId","data-v-697abeb3"]]),Ce={class:"flex justify-end flex-col-reverse sm:flex-row mt-4 gap-2"},he=T({__name:"EditProjectForm",props:{project:{},saveButtonLabel:{}},emits:["save","close"],setup(f,{expose:b}){const d=f,v={project_name:"",project_owner:void 0,team:[],status:void 0},n=S({...v}),h=H(()=>Object.keys(n.value).some(l=>{var t;return l==="team"?!1:n.value[l]!==((t=d.project??v)==null?void 0:t[l])}));b({isFormHasUnsavedChanges:h}),ne(()=>d.project,()=>{d.project&&(n.value={...d.project,project_owner:d.project.project_owner})},{immediate:!0});const j=l=>!!l||"This field is required",{users:C,filters:V}=L({pagination:S({page:1,perPage:100,total:10})}),{users:c,filters:a}=L({pagination:S({page:1,perPage:100,total:10})});return(l,t)=>{const _=r("VaInput"),$=r("VaSelect"),P=r("VaButton"),B=r("VaForm");return m(),F(B,{class:"flex flex-col gap-2"},{default:u(({validate:s})=>[o(_,{modelValue:n.value.project_name,"onUpdate:modelValue":t[0]||(t[0]=e=>n.value.project_name=e),label:"Project name",rules:[j]},null,8,["modelValue","rules"]),o($,{modelValue:n.value.project_owner,"onUpdate:modelValue":t[1]||(t[1]=e=>n.value.project_owner=e),search:i(a).search,"onUpdate:search":t[2]||(t[2]=e=>i(a).search=e),searchable:"",label:"Owner","text-by":"fullname","track-by":"id",rules:[j],options:i(c)},{content:u(({value:e})=>[e?(m(),k("div",{key:e.id,class:"flex items-center gap-1 mr-4"},[o(I,{user:e,size:"18px"},null,8,["user"]),D(" "+w(e.fullname),1)])):A("",!0)]),_:1},8,["modelValue","search","rules","options"]),o($,{modelValue:n.value.team,"onUpdate:modelValue":t[3]||(t[3]=e=>n.value.team=e),search:i(V).search,"onUpdate:search":t[4]||(t[4]=e=>i(V).search=e),label:"Team","text-by":"fullname","track-by":"id",multiple:"",rules:[e=>"length"in e&&e.length>0||"This field is required"],options:i(C),"max-visible-options":l.$vaBreakpoint.mdUp?3:1},{content:u(({valueArray:e})=>[e?(m(!0),k(M,{key:0},G(e,(U,O)=>(m(),k("div",{key:U.id,class:"flex items-center gap-1 mr-2"},[o(I,{user:U,size:"18px"},null,8,["user"]),D(" "+w(U.fullname)+w(O<e.length-1?",":""),1)]))),128)):A("",!0)]),_:1},8,["modelValue","search","rules","options","max-visible-options"]),o($,{modelValue:n.value.status,"onUpdate:modelValue":t[5]||(t[5]=e=>n.value.status=e),label:"Status",rules:[j],"track-by":"value","value-by":"value",options:[{text:"In progress",value:"in progress"},{text:"Archived",value:"archived"},{text:"Completed",value:"completed"},{text:"Important",value:"important"}]},{content:u(({value:e})=>[e?(m(),F(z,{key:0,status:e.value},null,8,["status"])):A("",!0)]),_:1},8,["modelValue","rules"]),p("div",Ce,[o(P,{preset:"secondary",color:"secondary",onClick:t[6]||(t[6]=e=>l.$emit("close"))},{default:u(()=>[D("Cancel")]),_:1}),o(P,{onClick:e=>s()&&l.$emit("save",n.value)},{default:u(()=>[D(w(l.saveButtonLabel),1)]),_:2},1032,["onClick"])])]),_:1})}}});const $e=W(he,[["__scopeId","data-v-cc1c112b"]]),Pe=p("h1",{class:"page-title"},"Projects",-1),Be={class:"flex flex-col md:flex-row gap-2 mb-2 justify-between"},Fe={class:"flex flex-col md:flex-row gap-2 justify-start"},Ue={key:0,class:"va-h5 mb-4"},De={key:1,class:"va-h5 mb-4"},Ie=T({__name:"ProjectsPage",setup(f){const b=te("projects-view",!0),d=le(),v=re(),n=ie(),{projects:h,update:j,add:C,isLoading:V,remove:c,pagination:a,sorting:l}=ae(),t=S(null),_=S(!1),$=g=>{t.value=g,_.value=!0},P=g=>{d.currentProjectName=g.project_name,d.currentProjectIndex=g.id,v.currentDataset=g.id,n.push({name:"dashboard"})},{init:B}=ce(),s=async g=>{_.value=!1,"id"in g?(await j(g),B({message:"Project updated",color:"success"})):(await C(g),B({message:"Project created",color:"success"}))},{confirm:e}=de(),U=async g=>{await e({title:"Delete project",message:`Are you sure you want to delete project "${g.project_name}"?`,okText:"Delete",size:"small",maxWidth:"380px"})&&(await c(g),B({message:"Project deleted",color:"success"}))},O=S(),Q=async g=>{O.value.isFormHasUnsavedChanges?await e({maxWidth:"380px",message:"Form has unsaved changes. Are you sure you want to close it?",size:"small"})&&g():g()};return(g,y)=>{const J=r("VaButtonToggle"),K=r("VaCardContent"),X=r("VaModal"),Y=r("VaCard");return m(),k(M,null,[Pe,o(Y,null,{default:u(()=>[o(K,null,{default:u(()=>[p("div",Be,[p("div",Fe,[o(J,{modelValue:i(b),"onUpdate:modelValue":y[0]||(y[0]=x=>q(b)?b.value=x:null),color:"background-element","border-color":"background-element",options:[{label:"Cards",value:!0},{label:"Table",value:!1}]},null,8,["modelValue"])])]),i(b)?(m(),F(fe,{key:0,projects:i(h),loading:i(V),onEdit:$,onDelete:U,onOpen:P},null,8,["projects","loading"])):(m(),F(ke,{key:1,"sort-by":i(l).sortBy,"onUpdate:sortBy":y[1]||(y[1]=x=>i(l).sortBy=x),"sorting-order":i(l).sortingOrder,"onUpdate:sortingOrder":y[2]||(y[2]=x=>i(l).sortingOrder=x),pagination:i(a),"onUpdate:pagination":y[3]||(y[3]=x=>q(a)?a.value=x:null),projects:i(h),loading:i(V),onEdit:$,onDelete:U,onOpen:P},null,8,["sort-by","sorting-order","pagination","projects","loading"]))]),_:1}),o(X,{modelValue:_.value,"onUpdate:modelValue":y[4]||(y[4]=x=>_.value=x),size:"small","mobile-fullscreen":"","close-button":"",stateful:"","hide-default-actions":"","before-cancel":Q},{default:u(({cancel:x,ok:Z})=>[t.value===null?(m(),k("h1",Ue,"Add project")):(m(),k("h1",De,"Edit project")),o($e,{ref_key:"editFormRef",ref:O,project:t.value,"save-button-label":t.value===null?"Add":"Save",onClose:x,onSave:ee=>{s(ee),Z()}},null,8,["project","save-button-label","onClose","onSave"])]),_:1},8,["modelValue"])]),_:1})],64)}}});export{Ie as default};
//# sourceMappingURL=ProjectsPage-18e9d747.js.map
